<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d6d6d; -webkit-text-stroke: #6d6d6d}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #0000ff; -webkit-text-stroke: #0000ff}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6b0001; -webkit-text-stroke: #6b0001}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #fb0007; -webkit-text-stroke: #fb0007}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4d5055; -webkit-text-stroke: #4d5055}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #137646; -webkit-text-stroke: #137646}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #093c94; -webkit-text-stroke: #093c94}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000; min-height: 16.0px}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #0e6e6d; -webkit-text-stroke: #0e6e6d}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #18702b; -webkit-text-stroke: #18702b}
    span.s1 {font-kerning: none; background-color: #ecf1f7}
    span.s2 {font-kerning: none; color: #fb0007; background-color: #ecf1f7; -webkit-text-stroke: 0px #fb0007}
    span.s3 {font-kerning: none; color: #2a2a2a; background-color: #ecf1f7; -webkit-text-stroke: 0px #2a2a2a}
    span.s4 {font-kerning: none; color: #6b0001; background-color: #ecf1f7; -webkit-text-stroke: 0px #6b0001}
    span.s5 {font-kerning: none; color: #000000; background-color: #ecf1f7; -webkit-text-stroke: 0px #000000}
    span.s6 {font-kerning: none; color: #0000ff; background-color: #ecf1f7; -webkit-text-stroke: 0px #0000ff}
    span.s7 {font-kerning: none; color: #18702b; background-color: #ecf1f7; -webkit-text-stroke: 0px #18702b}
    span.s8 {font-kerning: none; color: #093c94; background-color: #ecf1f7; -webkit-text-stroke: 0px #093c94}
    span.s9 {font-kerning: none; color: #137646; background-color: #ecf1f7; -webkit-text-stroke: 0px #137646}
    span.s10 {font-kerning: none; color: #6f0ec3; background-color: #ecf1f7; -webkit-text-stroke: 0px #6f0ec3}
    span.s11 {font-kerning: none}
    span.s12 {font-kerning: none; color: #4d5055; background-color: #ecf1f7; -webkit-text-stroke: 0px #4d5055}
    span.s13 {font-kerning: none; color: #a4450b; background-color: #ecf1f7; -webkit-text-stroke: 0px #a4450b}
    span.s14 {font-kerning: none; color: #0e6e6d; background-color: #ecf1f7; -webkit-text-stroke: 0px #0e6e6d}
    span.s15 {font-kerning: none; color: #bf1c25; background-color: #ecf1f7; -webkit-text-stroke: 0px #bf1c25}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s4">html</span><span class="s5"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s1">"zh-Hant"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">meta</span><span class="s5"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s6">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">meta</span><span class="s5"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s5"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">title</span><span class="s3">&gt;</span><span class="s1">零散木板定價計算器</span><span class="s3">&lt;/</span><span class="s4">title</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Tailwind CSS CDN --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s4">script</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">body</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s1"> </span><span class="s7">'Inter'</span><span class="s1">, </span><span class="s8">sans-serif</span><span class="s1">;</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s5"> </span><span class="s8">#f0f4f8</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">#334155</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">.container</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">max-width:</span><span class="s1"> </span><span class="s9">900px</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">margin:</span><span class="s1"> </span><span class="s9">2rem</span><span class="s1"> </span><span class="s8">auto</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s9">1.5rem</span><span class="s1">;</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s5"> </span><span class="s8">#ffffff</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-radius:</span><span class="s1"> </span><span class="s9">12px</span><span class="s1">;</span></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s5"> </span><span class="s1">0</span><span class="s5"> </span><span class="s1">10px</span><span class="s5"> </span><span class="s1">15px</span><span class="s5"> </span><span class="s1">-3px</span><span class="s5"> </span><span class="s8">rgba(</span><span class="s1">0</span><span class="s5">, </span><span class="s1">0</span><span class="s5">, </span><span class="s1">0</span><span class="s5">, </span><span class="s1">0.1</span><span class="s8">)</span><span class="s5">, </span><span class="s1">0</span><span class="s5"> </span><span class="s1">4px</span><span class="s5"> </span><span class="s1">6px</span><span class="s5"> </span><span class="s1">-2px</span><span class="s5"> </span><span class="s8">rgba(</span><span class="s1">0</span><span class="s5">, </span><span class="s1">0</span><span class="s5">, </span><span class="s1">0</span><span class="s5">, </span><span class="s1">0.05</span><span class="s8">)</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">h1</span><span class="s1">, </span><span class="s4">h2</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">#1e293b</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-weight:</span><span class="s1"> </span><span class="s9">700</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">label</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">display:</span><span class="s1"> </span><span class="s8">block</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">margin-bottom:</span><span class="s1"> </span><span class="s9">0.5rem</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-weight:</span><span class="s1"> </span><span class="s9">500</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">#475569</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">input</span><span class="s1">[</span><span class="s8">type</span><span class="s1">=</span><span class="s7">"number"</span><span class="s1">], </span><span class="s4">input</span><span class="s1">[</span><span class="s8">type</span><span class="s1">=</span><span class="s7">"text"</span><span class="s1">], </span><span class="s4">select</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s9">100%</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s9">0.75rem</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s9">1px</span><span class="s1"> </span><span class="s8">solid</span><span class="s1"> </span><span class="s8">#cbd5e1</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-radius:</span><span class="s1"> </span><span class="s9">8px</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-size:</span><span class="s1"> </span><span class="s9">1rem</span><span class="s1">;</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s5"> </span><span class="s1">border-color</span><span class="s5"> </span><span class="s9">0.2s</span><span class="s5"> </span><span class="s1">ease-in-out</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">input</span><span class="s5">[</span><span class="s8">type</span><span class="s5">=</span><span class="s7">"number"</span><span class="s5">]</span><span class="s1">:focus</span><span class="s5">, </span><span class="s1">input</span><span class="s5">[</span><span class="s8">type</span><span class="s5">=</span><span class="s7">"text"</span><span class="s5">]</span><span class="s1">:focus</span><span class="s5">, </span><span class="s1">select:focus</span><span class="s5"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">outline:</span><span class="s1"> </span><span class="s8">none</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-color:</span><span class="s1"> </span><span class="s8">#3b82f6</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">box-shadow:</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s9">3px</span><span class="s1"> </span><span class="s8">rgba(</span><span class="s9">59</span><span class="s1">, </span><span class="s9">130</span><span class="s1">, </span><span class="s9">246</span><span class="s1">, </span><span class="s9">0.25</span><span class="s8">)</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">.btn</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s9">0.75rem</span><span class="s1"> </span><span class="s9">1.5rem</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-radius:</span><span class="s1"> </span><span class="s9">8px</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-weight:</span><span class="s1"> </span><span class="s9">600</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">cursor:</span><span class="s1"> </span><span class="s8">pointer</span><span class="s1">;</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s5"> </span><span class="s1">background-color</span><span class="s5"> </span><span class="s9">0.2s</span><span class="s5"> </span><span class="s1">ease-in-out</span><span class="s5">, </span><span class="s1">transform</span><span class="s5"> </span><span class="s9">0.1s</span><span class="s5"> </span><span class="s1">ease-in-out</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-primary</span><span class="s5"> {</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s5"> </span><span class="s8">#3b82f6</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">#ffffff</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-primary:hover</span><span class="s5"> {</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s5"> </span><span class="s8">#2563eb</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">transform:</span><span class="s1"> </span><span class="s8">translateY(</span><span class="s9">-1px</span><span class="s8">)</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-secondary</span><span class="s5"> {</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s5"> </span><span class="s8">#e2e8f0</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">#475569</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.btn-secondary:hover</span><span class="s5"> {</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s5"> </span><span class="s8">#cbd5e1</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">transform:</span><span class="s1"> </span><span class="s8">translateY(</span><span class="s9">-1px</span><span class="s8">)</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.result-box</span><span class="s5"> {</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s5"> </span><span class="s8">#e0f2fe</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s9">2px</span><span class="s1"> </span><span class="s8">solid</span><span class="s1"> </span><span class="s8">#90cdf4</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s9">1.5rem</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-radius:</span><span class="s1"> </span><span class="s9">12px</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">text-align:</span><span class="s1"> </span><span class="s8">center</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-size:</span><span class="s1"> </span><span class="s9">1.5rem</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-weight:</span><span class="s1"> </span><span class="s9">700</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">#0c4a6e</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">.info-text</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-size:</span><span class="s1"> </span><span class="s9">0.9rem</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">#64748b</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">margin-top:</span><span class="s1"> </span><span class="s9">0.25rem</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.error-message</span><span class="s5"> {</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s5"> </span><span class="s8">#fee2e2</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">#ef4444</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s9">0.75rem</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-radius:</span><span class="s1"> </span><span class="s9">8px</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">margin-bottom:</span><span class="s1"> </span><span class="s9">1rem</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s9">1px</span><span class="s1"> </span><span class="s8">solid</span><span class="s1"> </span><span class="s8">#f87171</span><span class="s1">;</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s2">display:</span><span class="s5"> </span><span class="s8">none</span><span class="s5">; </span><span class="s1">/* Hidden by default */</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.error-message.active</span><span class="s5"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">display:</span><span class="s1"> </span><span class="s8">block</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.calculated-value</span><span class="s5"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-weight:</span><span class="s1"> </span><span class="s8">bold</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">#1e293b</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s9">0.5rem</span><span class="s1">;</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s5"> </span><span class="s8">#f8fafc</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-radius:</span><span class="s1"> </span><span class="s9">6px</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s9">1px</span><span class="s1"> </span><span class="s8">dashed</span><span class="s1"> </span><span class="s8">#cbd5e1</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">display:</span><span class="s1"> </span><span class="s8">block</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">text-align:</span><span class="s1"> </span><span class="s8">center</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.llm-output-box</span><span class="s5"> {</span></p>
<p class="p4"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s5"> </span><span class="s8">#f0fdf4</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s9">2px</span><span class="s1"> </span><span class="s8">solid</span><span class="s1"> </span><span class="s8">#a7f3d0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">padding:</span><span class="s1"> </span><span class="s9">1.5rem</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-radius:</span><span class="s1"> </span><span class="s9">12px</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">margin-top:</span><span class="s1"> </span><span class="s9">1.5rem</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-size:</span><span class="s1"> </span><span class="s9">1rem</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">#065f46</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">line-height:</span><span class="s1"> </span><span class="s9">1.6</span><span class="s1">;</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s2">white-space:</span><span class="s5"> </span><span class="s8">pre-wrap</span><span class="s5">; </span><span class="s1">/* Preserve whitespace and line breaks */</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.loading-spinner</span><span class="s5"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s9">4px</span><span class="s1"> </span><span class="s8">solid</span><span class="s1"> </span><span class="s8">#f3f3f3</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-top:</span><span class="s1"> </span><span class="s9">4px</span><span class="s1"> </span><span class="s8">solid</span><span class="s1"> </span><span class="s8">#3b82f6</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-radius:</span><span class="s1"> </span><span class="s9">50%</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s9">24px</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">height:</span><span class="s1"> </span><span class="s9">24px</span><span class="s1">;</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s2">animation:</span><span class="s5"> </span><span class="s1">spin</span><span class="s5"> </span><span class="s9">1s</span><span class="s5"> </span><span class="s1">linear</span><span class="s5"> </span><span class="s1">infinite</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">margin:</span><span class="s1"> </span><span class="s9">0</span><span class="s1"> </span><span class="s8">auto</span><span class="s1">;</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s2">display:</span><span class="s5"> </span><span class="s8">none</span><span class="s5">; </span><span class="s1">/* Hidden by default */</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.loading-spinner.active</span><span class="s5"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">display:</span><span class="s1"> </span><span class="s8">block</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">@keyframes</span><span class="s1"> </span><span class="s8">spin</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">0%</span><span class="s1"> { </span><span class="s2">transform:</span><span class="s1"> </span><span class="s8">rotate(</span><span class="s9">0deg</span><span class="s8">)</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">100%</span><span class="s1"> { </span><span class="s2">transform:</span><span class="s1"> </span><span class="s8">rotate(</span><span class="s9">360deg</span><span class="s8">)</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s4">body</span><span class="s5"> </span><span class="s1">class</span><span class="s3">=</span><span class="s6">"p-4"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"container"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">h1</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-3xl mb-6 text-center"</span><span class="s3">&gt;</span><span class="s5">零散木板定價計算器</span><span class="s3">&lt;/</span><span class="s4">h1</span><span class="s3">&gt;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"errorMessage"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"error-message"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s3">&gt;&lt;</span><span class="s4">strong</span><span class="s3">&gt;</span><span class="s1">輸入錯誤：</span><span class="s3">&lt;/</span><span class="s4">strong</span><span class="s3">&gt;&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">ul</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"errorList"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"list-disc list-inside"</span><span class="s3">&gt;&lt;/</span><span class="s4">ul</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mb-8 p-6 bg-blue-50 rounded-lg border border-blue-200"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">h2</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-xl mb-4 text-blue-800"</span><span class="s3">&gt;</span><span class="s1">A. 基本設定 (店鋪內部參數)</span><span class="s3">&lt;/</span><span class="s4">h2</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 md:grid-cols-2 gap-6"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">for</span><span class="s3">=</span><span class="s6">"originalBoardPrice"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">原件木板標準售價 (4尺 x 8尺)</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"originalBoardPrice"</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"320"</span><span class="s5"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0"</span><span class="s5"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-1"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"info-text"</span><span class="s3">&gt;</span><span class="s1">輸入一塊 4尺 x 8尺 木板的標準售價。</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">for</span><span class="s3">=</span><span class="s6">"fragmentMarkupFactor"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">零散銷售溢價係數 ($K_{fragment}$)</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"fragmentMarkupFactor"</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"1.3"</span><span class="s5"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"1"</span><span class="s5"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"0.1"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-1"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"info-text"</span><span class="s3">&gt;</span><span class="s1">零散銷售每平方尺價格是原件的倍數 (例如 2.0 代表翻倍)。</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">for</span><span class="s3">=</span><span class="s6">"wasteThresholdArea"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">廢料判斷門檻面積 (平方尺)</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"wasteThresholdArea"</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"2.0"</span><span class="s5"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0"</span><span class="s5"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"0.1"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-1"</span><span class="s5"> </span><span class="s2">readonly</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"info-text"</span><span class="s3">&gt;</span><span class="s1">小於此面積的碎料視為廢料 (預設 1尺 x 2尺 = 2平方尺)。</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">for</span><span class="s3">=</span><span class="s6">"pricePerCut"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">單刀切割服務費 ($F_{cut\_per\_knife}$)</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"pricePerCut"</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"3.0"</span><span class="s5"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0"</span><span class="s5"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-1"</span><span class="s5"> </span><span class="s2">readonly</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"info-text"</span><span class="s3">&gt;</span><span class="s1">每切割一刀的費用 (預設 $3)。</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">h2</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-xl mb-4 text-gray-800"</span><span class="s3">&gt;</span><span class="s1">B. 訂單詳情與計算 (同事填寫)</span><span class="s3">&lt;/</span><span class="s4">h2</span><span class="s3">&gt;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"mb-4"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s5"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"globalUnit"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"block text-sm font-semibold mb-2"</span><span class="s3">&gt;</span><span class="s5">選擇輸入單位:</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">select</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"globalUnit"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full p-2 border rounded-md"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">option</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"inch"</span><span class="s1"> </span><span class="s2">selected</span><span class="s3">&gt;</span><span class="s1">寸 (Inches)</span><span class="s3">&lt;/</span><span class="s4">option</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">option</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"feet"</span><span class="s3">&gt;</span><span class="s1">尺 (Feet)</span><span class="s3">&lt;/</span><span class="s4">option</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">option</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"mm"</span><span class="s3">&gt;</span><span class="s1">毫米 (Millimeters)</span><span class="s3">&lt;/</span><span class="s4">option</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">select</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"info-text mt-1"</span><span class="s3">&gt;</span><span class="s1">選擇後，下方所有長度和寬度輸入將以此單位為準。</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"info-text mt-1 text-red-600"</span><span class="s3">&gt;</span><span class="s1">**注意：** 寸的輸入請直接使用小數，例如 16-5/8 寸請輸入 16.625。</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"mb-6"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">h3</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-lg font-semibold mb-3 text-gray-700"</span><span class="s3">&gt;</span><span class="s5">1. 客人所需木板 (可多行填寫)</span><span class="s3">&lt;/</span><span class="s4">h3</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"customerItems"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"space-y-4"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Initial customer item row --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 sm:grid-cols-5 gap-4 items-end customer-item-row"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">寬 (</span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"unit-display"</span><span class="s3">&gt;</span><span class="s1">寸</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span><span class="s1">)</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"item-width"</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"24"</span><span class="s5"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s5"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">長 (</span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"unit-display"</span><span class="s3">&gt;</span><span class="s1">寸</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span><span class="s1">)</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"item-length"</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"30"</span><span class="s5"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s5"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">數量</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s1"> </span><span class="s2">type</span><span class="s3">=</span><span class="s6">"number"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"item-quantity"</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"1"</span><span class="s1"> </span><span class="s2">min</span><span class="s3">=</span><span class="s6">"1"</span><span class="s1"> </span><span class="s2">step</span><span class="s3">=</span><span class="s6">"1"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"col-span-2"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-sm text-gray-600"</span><span class="s3">&gt;</span><span class="s1">單塊面積: </span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"item-area"</span><span class="s3">&gt;</span><span class="s1">0</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span><span class="s1"> 平方尺</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-sm text-gray-600"</span><span class="s3">&gt;</span><span class="s1">總面積: </span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"item-total-area"</span><span class="s3">&gt;</span><span class="s1">0</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span><span class="s1"> 平方尺</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-secondary btn-sm mt-2 remove-item-btn"</span><span class="s3">&gt;</span><span class="s5">移除</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 sm:grid-cols-5 gap-4 items-end customer-item-row"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">寬 (</span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"unit-display"</span><span class="s3">&gt;</span><span class="s1">寸</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span><span class="s1">)</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"item-width"</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"10"</span><span class="s5"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s5"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">長 (</span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"unit-display"</span><span class="s3">&gt;</span><span class="s1">寸</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span><span class="s1">)</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"item-length"</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"10"</span><span class="s5"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s5"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">數量</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s1"> </span><span class="s2">type</span><span class="s3">=</span><span class="s6">"number"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"item-quantity"</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"1"</span><span class="s1"> </span><span class="s2">min</span><span class="s3">=</span><span class="s6">"1"</span><span class="s1"> </span><span class="s2">step</span><span class="s3">=</span><span class="s6">"1"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"col-span-2"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-sm text-gray-600"</span><span class="s3">&gt;</span><span class="s1">單塊面積: </span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"item-area"</span><span class="s3">&gt;</span><span class="s1">0</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span><span class="s1"> 平方尺</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-sm text-gray-600"</span><span class="s3">&gt;</span><span class="s1">總面積: </span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"item-total-area"</span><span class="s3">&gt;</span><span class="s1">0</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span><span class="s1"> 平方尺</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-secondary btn-sm mt-2 remove-item-btn"</span><span class="s3">&gt;</span><span class="s5">移除</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"addCustomerItem"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-secondary mt-4"</span><span class="s3">&gt;</span><span class="s5">新增客人所需木板</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">h3</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-lg font-semibold mb-3 text-yellow-800"</span><span class="s3">&gt;</span><span class="s5">2. 剩餘板材信息 (請輸入所有可用碎料)</span><span class="s3">&lt;/</span><span class="s4">h3</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"info-text mb-2"</span><span class="s3">&gt;</span><span class="s1">請輸入您所有可用於切割的零散板材的尺寸和數量。系統會嘗試從中匹配。</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"stockItems"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"space-y-4"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Initial stock item row --&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 md:grid-cols-4 gap-4 items-end stock-item-row"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">存貨寬度 (</span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"unit-display"</span><span class="s3">&gt;</span><span class="s1">寸</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span><span class="s1">)</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"stock-width"</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"48"</span><span class="s5"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s5"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">存貨長度 (</span><span class="s3">&lt;</span><span class="s4">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"unit-display"</span><span class="s3">&gt;</span><span class="s1">寸</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span><span class="s1">)</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"stock-length"</span><span class="s5"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"48"</span><span class="s5"> </span><span class="s2">min</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s5"> </span><span class="s2">step</span><span class="s3">=</span><span class="s1">"0.01"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">存貨數量</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s1"> </span><span class="s2">type</span><span class="s3">=</span><span class="s6">"number"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"stock-quantity"</span><span class="s1"> </span><span class="s2">value</span><span class="s3">=</span><span class="s6">"1"</span><span class="s1"> </span><span class="s2">min</span><span class="s3">=</span><span class="s6">"1"</span><span class="s1"> </span><span class="s2">step</span><span class="s3">=</span><span class="s6">"1"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-secondary btn-sm mt-2 remove-stock-btn"</span><span class="s3">&gt;</span><span class="s5">移除</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"addStockItem"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-secondary mt-4"</span><span class="s3">&gt;</span><span class="s5">新增存貨板材</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mb-6 p-4 bg-red-50 rounded-lg border border-red-200"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">h3</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-lg font-semibold mb-3 text-red-800"</span><span class="s3">&gt;</span><span class="s5">3. 切割方案與廢料判斷 (自動計算)</span><span class="s3">&lt;/</span><span class="s4">h3</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"info-text mb-3"</span><span class="s3">&gt;</span><span class="s1">系統會根據客人需求和可用存貨，自動估算刀數和需計入的廢料面積。</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 md:grid-cols-2 gap-4"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">估計所需刀數</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">span</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"calculatedCuts"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"calculated-value"</span><span class="s3">&gt;</span><span class="s5">0</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"info-text"</span><span class="s3">&gt;</span><span class="s1">為切割出所有客人所需木板，總共需要切割的刀數。</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">label</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"block text-sm"</span><span class="s3">&gt;</span><span class="s1">需計入的廢料面積 (平方尺)</span><span class="s3">&lt;/</span><span class="s4">label</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">span</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"calculatedWasteArea"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"calculated-value"</span><span class="s3">&gt;</span><span class="s5">0.00</span><span class="s3">&lt;/</span><span class="s4">span</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"info-text"</span><span class="s3">&gt;</span><span class="s1">所有切割後，面積小於 2 平方尺的碎料總面積。</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"unfulfilledDemandMessage"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"info-text mt-4 text-red-600 font-bold hidden"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>**警告：** 某些客人所需木板因存貨不足而無法滿足。請檢查存貨數量和尺寸。</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"calculatePriceBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-primary w-full mt-6"</span><span class="s3">&gt;</span><span class="s5">計算最終報價</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-6 bg-green-50 rounded-lg border border-green-200"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">h2</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl mb-4 text-green-800"</span><span class="s3">&gt;</span><span class="s5">C. 最終報價</span><span class="s3">&lt;/</span><span class="s4">h2</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"result-box"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-base font-normal mb-2"</span><span class="s3">&gt;</span><span class="s5">建議報價:</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-4xl font-bold"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"finalPrice"</span><span class="s3">&gt;</span><span class="s5">$0.00</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"explainQuoteBtn"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-secondary w-full mt-4"</span><span class="s3">&gt;</span><span class="s5">✨ 解釋報價</span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"llmLoadingSpinner"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"loading-spinner mt-4"</span><span class="s3">&gt;&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"llmExplanationOutput"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"llm-output-box hidden"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s1">&lt;!-- LLM generated explanation will be displayed here --&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// DOM Element References</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> originalBoardPriceInput = document.getElementById(</span><span class="s7">'originalBoardPrice'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> fragmentMarkupFactorInput = document.getElementById(</span><span class="s7">'fragmentMarkupFactor'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> wasteThresholdAreaInput = document.getElementById(</span><span class="s7">'wasteThresholdArea'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> pricePerCutInput = document.getElementById(</span><span class="s7">'pricePerCut'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> globalUnitSelect = document.getElementById(</span><span class="s7">'globalUnit'</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> customerItemsContainer = document.getElementById(</span><span class="s7">'customerItems'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> addCustomerItemBtn = document.getElementById(</span><span class="s7">'addCustomerItem'</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> stockItemsContainer = document.getElementById(</span><span class="s7">'stockItems'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> addStockItemBtn = document.getElementById(</span><span class="s7">'addStockItem'</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> calculatedCutsDisplay = document.getElementById(</span><span class="s7">'calculatedCuts'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> calculatedWasteAreaDisplay = document.getElementById(</span><span class="s7">'calculatedWasteArea'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> unfulfilledDemandMessage = document.getElementById(</span><span class="s7">'unfulfilledDemandMessage'</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> calculatePriceBtn = document.getElementById(</span><span class="s7">'calculatePriceBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> finalPriceDisplay = document.getElementById(</span><span class="s7">'finalPrice'</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> errorMessageDiv = document.getElementById(</span><span class="s7">'errorMessage'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> errorList = document.getElementById(</span><span class="s7">'errorList'</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> explainQuoteBtn = document.getElementById(</span><span class="s7">'explainQuoteBtn'</span><span class="s1">); </span><span class="s12">// New LLM button</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> llmLoadingSpinner = document.getElementById(</span><span class="s7">'llmLoadingSpinner'</span><span class="s1">); </span><span class="s12">// New loading spinner</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> llmExplanationOutput = document.getElementById(</span><span class="s7">'llmExplanationOutput'</span><span class="s1">); </span><span class="s12">// New LLM output div</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Constants</span></p>
<p class="p10"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s5"> </span><span class="s1">ORIGINAL_BOARD_TOTAL_AREA</span><span class="s5"> = </span><span class="s13">32</span><span class="s5">; </span><span class="s12">// 4尺 x 8尺 = 32 平方尺</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s5"> </span><span class="s14">MAX_BOARD_LENGTH_FEET</span><span class="s5"> = </span><span class="s13">8</span><span class="s5">;<span class="Apple-converted-space">      </span></span><span class="s1">// 8 尺 = 96 寸 = 2438.4 毫米</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s5"> </span><span class="s14">MAX_BOARD_WIDTH_FEET</span><span class="s5"> = </span><span class="s13">4</span><span class="s5">; <span class="Apple-converted-space">      </span></span><span class="s1">// 4 尺 = 48 寸 = 1219.2 毫米</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s5"> </span><span class="s14">EPSILON</span><span class="s5"> = </span><span class="s13">0.001</span><span class="s5">; </span><span class="s1">// Small value for float comparison tolerance</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Global variables to store calculated values for LLM explanation</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> currentTotalCustomerArea = </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> currentTotalChargeableWasteArea = </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> currentTotalCuts = </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> currentPricePerCut = </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> currentFinalCalculatedPrice = </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Unit Conversion Function: Converts value from selected unit to feet</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> convertToFeet(value, unit) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (unit === </span><span class="s7">'feet'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s1"> value;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">else</span><span class="s1"> </span><span class="s10">if</span><span class="s1"> (unit === </span><span class="s7">'inch'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s1"> value / </span><span class="s13">12</span><span class="s1">; </span><span class="s12">// 1 foot = 12 inches</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">else</span><span class="s1"> </span><span class="s10">if</span><span class="s1"> (unit === </span><span class="s7">'mm'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s1"> value / </span><span class="s13">304.8</span><span class="s1">; </span><span class="s12">// 1 foot = 304.8 mm</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Function: Updates unit labels for all length/width input fields</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> updateUnitLabels(unit) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> unitDisplays = document.querySelectorAll(</span><span class="s7">'.unit-display'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> unitText = </span><span class="s7">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (unit === </span><span class="s7">'feet'</span><span class="s1">) unitText = </span><span class="s7">'尺'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">else</span><span class="s1"> </span><span class="s10">if</span><span class="s1"> (unit === </span><span class="s7">'inch'</span><span class="s1">) unitText = </span><span class="s7">'寸'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">else</span><span class="s1"> </span><span class="s10">if</span><span class="s1"> (unit === </span><span class="s7">'mm'</span><span class="s1">) unitText = </span><span class="s7">'毫米'</span><span class="s1">;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>unitDisplays.forEach(span =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>span.textContent = unitText;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Function: Validates if dimensions exceed the maximum board size</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> validateDimensions(length, width, unit, inputName) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> lengthInFeet = convertToFeet(length, unit);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> widthInFeet = convertToFeet(width, unit);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> errors = [];</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// IMPORTANT: Width is the first input, Length is the second</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// MAX_BOARD_WIDTH_FEET corresponds to the first input (new 'width')</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// MAX_BOARD_LENGTH_FEET corresponds to the second input (new 'length')</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s5"> (widthInFeet &gt; </span><span class="s14">MAX_BOARD_WIDTH_FEET</span><span class="s5"> + </span><span class="s14">EPSILON</span><span class="s5">) { </span><span class="s1">// Check against MAX_BOARD_WIDTH_FEET</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>errors.push(</span><span class="s7">`</span><span class="s1">${inputName}</span><span class="s7"> 寬度 (</span><span class="s1">${width}</span><span class="s7"> </span><span class="s1">${unit}</span><span class="s7">) 超過原板材最大寬度 (4 尺 / 48 寸 / 1.22 米)。`</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s5"> (lengthInFeet &gt; </span><span class="s14">MAX_BOARD_LENGTH_FEET</span><span class="s5"> + </span><span class="s14">EPSILON</span><span class="s5">) { </span><span class="s1">// Check against MAX_BOARD_LENGTH_FEET</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>errors.push(</span><span class="s7">`</span><span class="s1">${inputName}</span><span class="s7"> 長度 (</span><span class="s1">${length}</span><span class="s7"> </span><span class="s1">${unit}</span><span class="s7">) 超過原板材最大長度 (8 尺 / 96 寸 / 2.44 米)。`</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> errors;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Function: Displays or hides error messages</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> displayErrors(errors) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>errorList.innerHTML = </span><span class="s7">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (errors.length &gt; </span><span class="s13">0</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>errors.forEach(err =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> li = document.createElement(</span><span class="s7">'li'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>li.textContent = err;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>errorList.appendChild(li);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>errorMessageDiv.classList.add(</span><span class="s7">'active'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s1"> </span><span class="s10">true</span><span class="s1">; </span><span class="s12">// Errors exist</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>errorMessageDiv.classList.remove(</span><span class="s7">'active'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s1"> </span><span class="s10">false</span><span class="s1">; </span><span class="s12">// No errors</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Function: Updates area display and validates dimensions for a single item row</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> updateItemAreaAndValidate(row, isStock = </span><span class="s10">false</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> currentUnit = globalUnitSelect.value;</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Note: item-width is now the first input, item-length is the second</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> widthInput = row.querySelector(isStock ? </span><span class="s7">'.stock-width'</span><span class="s1"> : </span><span class="s7">'.item-width'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> lengthInput = row.querySelector(isStock ? </span><span class="s7">'.stock-length'</span><span class="s1"> : </span><span class="s7">'.item-length'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> quantityInput = row.querySelector(isStock ? </span><span class="s7">'.stock-quantity'</span><span class="s1"> : </span><span class="s7">'.item-quantity'</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> width = parseFloat(widthInput.value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> length = parseFloat(lengthInput.value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> quantity = parseInt(quantityInput.value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> widthInFeet = convertToFeet(width, currentUnit);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> lengthInFeet = convertToFeet(length, currentUnit);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> singleArea = lengthInFeet * widthInFeet; </span><span class="s12">// Area calculation remains L*W</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> totalArea = singleArea * quantity;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s5"> (!isStock) { </span><span class="s1">// Only customer items display area</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>row.querySelector(</span><span class="s7">'.item-area'</span><span class="s1">).textContent = singleArea.toFixed(</span><span class="s13">2</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>row.querySelector(</span><span class="s7">'.item-total-area'</span><span class="s1">).textContent = totalArea.toFixed(</span><span class="s13">2</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Validate dimensions with swapped roles for width/length inputs</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> errors = validateDimensions(length, width, currentUnit, isStock ? </span><span class="s7">'存貨板材'</span><span class="s1"> : </span><span class="s7">'客人所需木板'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> errors;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Function: Adds a new customer item row</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> addCustomerItemRow() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> newItemRow = document.createElement(</span><span class="s7">'div'</span><span class="s1">);</span></p>
<p class="p11"><span class="s5"><span class="Apple-converted-space">            </span>newItemRow.className = </span><span class="s1">'grid grid-cols-1 sm:grid-cols-5 gap-4 items-end customer-item-row'</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>newItemRow.innerHTML = </span><span class="s7">`</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-sm"&gt;寬 (&lt;span class="unit-display"&gt;&lt;/span&gt;)&lt;/label&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="number" class="item-width" value="0" min="0.01" step="0.01"&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-sm"&gt;長 (&lt;span class="unit-display"&gt;&lt;/span&gt;)&lt;/label&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="number" class="item-length" value="0" min="0.01" step="0.01"&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-sm"&gt;數量&lt;/label&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="number" class="item-quantity" value="1" min="1" step="1"&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="col-span-2"&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-sm text-gray-600"&gt;單塊面積: &lt;span class="item-area"&gt;0&lt;/span&gt; 平方尺&lt;/p&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-sm text-gray-600"&gt;總面積: &lt;span class="item-total-area"&gt;0&lt;/span&gt; 平方尺&lt;/p&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button class="btn btn-secondary btn-sm mt-2 remove-item-btn"&gt;移除&lt;/button&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>customerItemsContainer.appendChild(newItemRow);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>updateUnitLabels(globalUnitSelect.value); </span><span class="s12">// Update unit display for new row</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>newItemRow.querySelectorAll(</span><span class="s7">'input'</span><span class="s1">).forEach(input =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>input.addEventListener(</span><span class="s7">'input'</span><span class="s1">, calculatePrice); </span><span class="s12">// Trigger calculation on any input change</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>newItemRow.querySelector(</span><span class="s7">'.remove-item-btn'</span><span class="s1">).addEventListener(</span><span class="s7">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>newItemRow.remove();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>calculatePrice();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>updateItemAreaAndValidate(newItemRow); </span><span class="s12">// Initialize area display for new row</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Function: Adds a new stock item row</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> addStockItemRow() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> newStockRow = document.createElement(</span><span class="s7">'div'</span><span class="s1">);</span></p>
<p class="p11"><span class="s5"><span class="Apple-converted-space">            </span>newStockRow.className = </span><span class="s1">'grid grid-cols-1 md:grid-cols-4 gap-4 items-end stock-item-row'</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>newStockRow.innerHTML = </span><span class="s7">`</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-sm"&gt;存貨寬度 (&lt;span class="unit-display"&gt;&lt;/span&gt;)&lt;/label&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="number" class="stock-width" value="0" min="0.01" step="0.01"&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-sm"&gt;存貨長度 (&lt;span class="unit-display"&gt;&lt;/span&gt;)&lt;/label&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="number" class="stock-length" value="0" min="0.01" step="0.01"&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-sm"&gt;存貨數量&lt;/label&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="number" class="stock-quantity" value="1" min="1" step="1"&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button class="btn btn-secondary btn-sm mt-2 remove-stock-btn"&gt;移除&lt;/button&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p11"><span class="s1"><span class="Apple-converted-space">            </span>`</span><span class="s5">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>stockItemsContainer.appendChild(newStockRow);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>updateUnitLabels(globalUnitSelect.value); </span><span class="s12">// Update unit display for new row</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>newStockRow.querySelectorAll(</span><span class="s7">'input'</span><span class="s1">).forEach(input =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>input.addEventListener(</span><span class="s7">'input'</span><span class="s1">, calculatePrice); </span><span class="s12">// Trigger calculation on any input change</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>newStockRow.querySelector(</span><span class="s7">'.remove-stock-btn'</span><span class="s1">).addEventListener(</span><span class="s7">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>newStockRow.remove();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>calculatePrice();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>updateItemAreaAndValidate(newStockRow, </span><span class="s10">true</span><span class="s1">); </span><span class="s12">// Initialize area display for new row (as stock)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Helper function to calculate remainders from a guillotine cut</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Returns two potential remainder pieces (L, W, Area)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> getGuillotineRemainders(stockL, stockW, cutL, cutW) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> remainders = [];</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Option 1: Cut along stockL (cut the length first)</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Resulting pieces: (cutL, cutW) and two remainders:</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// R1: (stockL - cutL, stockW)</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// R2: (cutL, stockW - cutW)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> rem1_L_cut = { </span><span class="s14">L</span><span class="s1">: stockL - cutL, </span><span class="s14">W</span><span class="s1">: stockW };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> rem2_L_cut = { </span><span class="s14">L</span><span class="s1">: cutL, </span><span class="s14">W</span><span class="s1">: stockW - cutW };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> totalRemainderArea_L_cut = (rem1_L_cut.</span><span class="s14">L</span><span class="s1"> * rem1_L_cut.</span><span class="s14">W</span><span class="s1">) + (rem2_L_cut.</span><span class="s14">L</span><span class="s1"> * rem2_L_cut.</span><span class="s14">W</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Option 2: Cut along stockW (cut the width first)</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Resulting pieces: (cutL, cutW) and two remainders:</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// R1: (stockL, stockW - cutW)</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// R2: (stockL - cutL, cutW)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> rem1_W_cut = { </span><span class="s14">L</span><span class="s1">: stockL, </span><span class="s14">W</span><span class="s1">: stockW - cutW };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> rem2_W_cut = { </span><span class="s14">L</span><span class="s1">: stockL - cutL, </span><span class="s14">W</span><span class="s1">: cutW };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> totalRemainderArea_W_cut = (rem1_W_cut.</span><span class="s14">L</span><span class="s1"> * rem1_W_cut.</span><span class="s14">W</span><span class="s1">) + (rem2_W_cut.</span><span class="s14">L</span><span class="s1"> * rem2_W_cut.</span><span class="s14">W</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (totalRemainderArea_L_cut &lt; totalRemainderArea_W_cut) {</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s1">// Choose L_cut if it results in less total remainder waste</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>remainders.push(rem1_L_cut, rem2_L_cut);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">else</span><span class="s1"> {</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s1">// Otherwise, choose W_cut</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>remainders.push(rem1_W_cut, rem2_W_cut);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> remainders.filter(r =&gt; r.</span><span class="s14">L</span><span class="s1"> &gt; </span><span class="s14">EPSILON</span><span class="s1"> &amp;&amp; r.</span><span class="s14">W</span><span class="s1"> &gt; </span><span class="s14">EPSILON</span><span class="s1">); </span><span class="s12">// Filter out zero or negative dimensions</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Custom rounding function based on user's rule</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> roundToNearestFive(price) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> integerPart = </span><span class="s14">Math</span><span class="s1">.floor(price);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> decimalPart = price - integerPart;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Handle decimal part first: round to nearest integer</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> roundedInteger = </span><span class="s14">Math</span><span class="s1">.round(price); </span><span class="s12">// Standard rounding to nearest integer</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Now apply custom rounding to the last digit of the integer part</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> lastDigit = roundedInteger % </span><span class="s13">10</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> finalRoundedPrice = roundedInteger;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (lastDigit &gt;= </span><span class="s13">0</span><span class="s1"> &amp;&amp; lastDigit &lt;= </span><span class="s13">2</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>finalRoundedPrice = roundedInteger - lastDigit; </span><span class="s12">// Round down to nearest 0</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">else</span><span class="s1"> </span><span class="s10">if</span><span class="s1"> (lastDigit &gt;= </span><span class="s13">3</span><span class="s1"> &amp;&amp; lastDigit &lt;= </span><span class="s13">6</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>finalRoundedPrice = roundedInteger - lastDigit + </span><span class="s13">5</span><span class="s1">; </span><span class="s12">// Round to 5 (e.g., 93-&gt;95, 94-&gt;95, 95-&gt;95, 96-&gt;95)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">else</span><span class="s1"> </span><span class="s10">if</span><span class="s1"> (lastDigit &gt;= </span><span class="s13">7</span><span class="s1"> &amp;&amp; lastDigit &lt;= </span><span class="s13">9</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>finalRoundedPrice = roundedInteger - lastDigit + </span><span class="s13">10</span><span class="s1">; </span><span class="s12">// Round up to nearest 0</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> finalRoundedPrice;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Main Calculation Function</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> calculatePrice() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> allErrors = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>unfulfilledDemandMessage.classList.add(</span><span class="s7">'hidden'</span><span class="s1">); </span><span class="s12">// Hide warning at start of calculation</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// 1. Validate all input dimensions</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.querySelectorAll(</span><span class="s7">'.customer-item-row'</span><span class="s1">).forEach(row =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> errors = updateItemAreaAndValidate(row);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>allErrors = allErrors.concat(errors);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.querySelectorAll(</span><span class="s7">'.stock-item-row'</span><span class="s1">).forEach(row =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> errors = updateItemAreaAndValidate(row, </span><span class="s10">true</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>allErrors = allErrors.concat(errors);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (displayErrors(allErrors)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>finalPriceDisplay.textContent = </span><span class="s7">`</span><span class="s15">$</span><span class="s7">0.00`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>calculatedCutsDisplay.textContent = </span><span class="s7">'0'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>calculatedWasteAreaDisplay.textContent = </span><span class="s7">'0.00'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> originalBoardPrice = parseFloat(originalBoardPriceInput.value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> fragmentMarkupFactor = parseFloat(fragmentMarkupFactorInput.value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> pricePerCut = parseFloat(pricePerCutInput.value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> wasteThresholdArea = parseFloat(wasteThresholdAreaInput.value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> unitPriceOriginal = originalBoardPrice / </span><span class="s14">ORIGINAL_BOARD_TOTAL_AREA</span><span class="s1">;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// 2. Prepare customer demand list (flattened by quantity)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> customerPieces = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.querySelectorAll(</span><span class="s7">'.customer-item-row'</span><span class="s1">).forEach(row =&gt; {</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s1">// Note: width is now the first input, length is the second</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> width = parseFloat(row.querySelector(</span><span class="s7">'.item-width'</span><span class="s1">).value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> length = parseFloat(row.querySelector(</span><span class="s7">'.item-length'</span><span class="s1">).value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> quantity = parseInt(row.querySelector(</span><span class="s7">'.item-quantity'</span><span class="s1">).value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> lengthInFeet = convertToFeet(length, globalUnitSelect.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> widthInFeet = convertToFeet(width, globalUnitSelect.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> area = lengthInFeet * widthInFeet;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">for</span><span class="s1"> (</span><span class="s10">let</span><span class="s1"> i = </span><span class="s13">0</span><span class="s1">; i &lt; quantity; i++) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>customerPieces.push({ length: lengthInFeet, width: widthInFeet, area: area, fulfilled: </span><span class="s10">false</span><span class="s1"> });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// 3. Prepare available stock list (flattened by quantity and make them mutable)</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s5"> mutableStock = []; </span><span class="s1">// Use a mutable copy for simulation</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.querySelectorAll(</span><span class="s7">'.stock-item-row'</span><span class="s1">).forEach(row =&gt; {</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s1">// Note: stock-width is now the first input, stock-length is the second</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> width = parseFloat(row.querySelector(</span><span class="s7">'.stock-width'</span><span class="s1">).value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> length = parseFloat(row.querySelector(</span><span class="s7">'.stock-length'</span><span class="s1">).value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> quantity = parseInt(row.querySelector(</span><span class="s7">'.stock-quantity'</span><span class="s1">).value) || </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> lengthInFeet = convertToFeet(length, globalUnitSelect.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> widthInFeet = convertToFeet(width, globalUnitSelect.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> area = lengthInFeet * widthInFeet;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">for</span><span class="s1"> (</span><span class="s10">let</span><span class="s1"> i = </span><span class="s13">0</span><span class="s1">; i &lt; quantity; i++) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>mutableStock.push({</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>length: lengthInFeet, </span><span class="s12">// These are the current available dimensions</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>width: widthInFeet,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>area: area</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// 4. Automatic Cut and Waste Calculation (Guillotine Cut Simulation &amp; New Cut Logic)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> totalCuts = </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> totalChargeableWasteArea = </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> unfulfilledCount = </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Sort customer pieces by area (descending) to prioritize larger cuts</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>customerPieces.sort((a, b) =&gt; b.area - a.area);</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// --- Calculate totalCuts based on customer pieces grouping (independent of stock matching) ---</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s5"> groupedCustomerPiecesForCuts = </span><span class="s10">new</span><span class="s5"> </span><span class="s14">Map</span><span class="s5">(); </span><span class="s1">// Map&lt;normalized_width_in_feet, Map&lt;normalized_length_in_feet, count&gt;&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>customerPieces.forEach(piece =&gt; {</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s1">// Normalize dimensions: always store smaller as width, larger as length for consistent grouping</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> normalizedDim1 = </span><span class="s14">Math</span><span class="s1">.min(piece.width, piece.length);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> normalizedDim2 = </span><span class="s14">Math</span><span class="s1">.max(piece.width, piece.length);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s1">// Use a string key for map to handle float precision for grouping</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> widthKey = normalizedDim1.toFixed(</span><span class="s13">4</span><span class="s1">);<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> lengthKey = normalizedDim2.toFixed(</span><span class="s13">4</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> (!groupedCustomerPiecesForCuts.has(widthKey)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>groupedCustomerPiecesForCuts.</span><span class="s10">set</span><span class="s1">(widthKey, </span><span class="s10">new</span><span class="s1"> </span><span class="s14">Map</span><span class="s1">());</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> lengthsMap = groupedCustomerPiecesForCuts.</span><span class="s10">get</span><span class="s1">(widthKey);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>lengthsMap.</span><span class="s10">set</span><span class="s1">(lengthKey, (lengthsMap.</span><span class="s10">get</span><span class="s1">(lengthKey) || </span><span class="s13">0</span><span class="s1">) + </span><span class="s13">1</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">for</span><span class="s1"> (</span><span class="s10">const</span><span class="s1"> [widthKey, lengthsMap] </span><span class="s10">of</span><span class="s1"> groupedCustomerPiecesForCuts.entries()) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">let</span><span class="s1"> totalPiecesInWidthGroup = </span><span class="s13">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">for</span><span class="s1"> (</span><span class="s10">const</span><span class="s1"> count </span><span class="s10">of</span><span class="s1"> lengthsMap.values()) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>totalPiecesInWidthGroup += count;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> distinctLengthsCount = lengthsMap.size;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> (distinctLengthsCount === </span><span class="s13">1</span><span class="s1">) {</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">// Scenario 1: All pieces in this width group are identical (same L, same W)</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">// Each piece needs 2 cuts</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>totalCuts += (</span><span class="s13">2</span><span class="s1"> * totalPiecesInWidthGroup);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s10">else</span><span class="s1"> {</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">// Scenario 2: Same width, different lengths. Apply (N+1) rule for this width group.</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">// This implies one initial rip cut to get the desired width strip, then N cross-cuts.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>totalCuts += (totalPiecesInWidthGroup + </span><span class="s13">1</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// --- End of totalCuts calculation ---</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// --- Simulate cutting for waste calculation and fulfillment ---</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>customerPieces.forEach(customerPiece =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> (customerPiece.fulfilled) </span><span class="s10">return</span><span class="s1">;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">let</span><span class="s1"> bestStockIndex = -</span><span class="s13">1</span><span class="s1">;</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s10">let</span><span class="s5"> minTotalRemainderArea = </span><span class="s14">Infinity</span><span class="s5">; </span><span class="s1">// Track the smallest total area of remainders after a cut</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s1">// Sort mutableStock by area (descending) before searching for a fit for the current customer piece</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>mutableStock.sort((a, b) =&gt; b.area - a.area);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s1">// Find the best matching stock piece from mutableStock</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">for</span><span class="s1"> (</span><span class="s10">let</span><span class="s1"> i = </span><span class="s13">0</span><span class="s1">; i &lt; mutableStock.length; i++) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> stockPiece = mutableStock[i];</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">// Check if the stock piece can fit the customer piece (considering rotation)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">let</span><span class="s1"> fitNormal = (stockPiece.length &gt;= customerPiece.length - </span><span class="s14">EPSILON</span><span class="s1"> &amp;&amp; stockPiece.width &gt;= customerPiece.width - </span><span class="s14">EPSILON</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">let</span><span class="s1"> fitRotated = (stockPiece.length &gt;= customerPiece.width - </span><span class="s14">EPSILON</span><span class="s1"> &amp;&amp; stockPiece.width &gt;= customerPiece.length - </span><span class="s14">EPSILON</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> (fitNormal || fitRotated) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">let</span><span class="s1"> currentCutL = customerPiece.length;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">let</span><span class="s1"> currentCutW = customerPiece.width;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">if</span><span class="s1"> (fitRotated &amp;&amp; !fitNormal) { </span><span class="s12">// Only fit rotated if normal doesn't fit</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>[currentCutL, currentCutW] = [customerPiece.width, customerPiece.length];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>} </span><span class="s10">else</span><span class="s1"> </span><span class="s10">if</span><span class="s1"> (fitNormal &amp;&amp; fitRotated) { </span><span class="s12">// If both fit, choose the one that minimizes waste</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                            </span></span><span class="s1">// Calculate remainders for normal orientation</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s10">const</span><span class="s1"> remsNormal = getGuillotineRemainders(stockPiece.length, stockPiece.width, customerPiece.length, customerPiece.width);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s10">const</span><span class="s1"> totalRemAreaNormal = remsNormal.reduce((sum, r) =&gt; sum + (r.</span><span class="s14">L</span><span class="s1"> * r.</span><span class="s14">W</span><span class="s1">), </span><span class="s13">0</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                            </span></span><span class="s1">// Calculate remainders for rotated orientation</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s10">const</span><span class="s1"> remsRotated = getGuillotineRemainders(stockPiece.length, stockPiece.width, customerPiece.width, customerPiece.length);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s10">const</span><span class="s1"> totalRemAreaRotated = remsRotated.reduce((sum, r) =&gt; sum + (r.</span><span class="s14">L</span><span class="s1"> * r.</span><span class="s14">W</span><span class="s1">), </span><span class="s13">0</span><span class="s1">);</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                            </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s10">if</span><span class="s1"> (totalRemAreaRotated &lt; totalRemAreaNormal) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>[currentCutL, currentCutW] = [customerPiece.width, customerPiece.length]; </span><span class="s12">// Use rotated dimensions</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                            </span></span><span class="s1">// Else, use normal dimensions (already set)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                        </span></span><span class="s1">// Get the actual remainder pieces for the chosen cut orientation</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> potentialRemainderPieces = getGuillotineRemainders(stockPiece.length, stockPiece.width, currentCutL, currentCutW);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> totalPotentialRemainderArea = potentialRemainderPieces.reduce((sum, r) =&gt; sum + (r.</span><span class="s14">L</span><span class="s1"> * r.</span><span class="s14">W</span><span class="s1">), </span><span class="s13">0</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">if</span><span class="s1"> (totalPotentialRemainderArea &lt; minTotalRemainderArea) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>minTotalRemainderArea = totalPotentialRemainderArea;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>bestStockIndex = i;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> (bestStockIndex !== -</span><span class="s13">1</span><span class="s1">) {</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">// Found a match, perform the cut</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> usedStockPiece = mutableStock[bestStockIndex];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>customerPiece.fulfilled = </span><span class="s10">true</span><span class="s1">; </span><span class="s12">// Mark customer demand as fulfilled</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">// Determine the actual cut dimensions used (normal or rotated)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">let</span><span class="s1"> actualCutL = customerPiece.length;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">let</span><span class="s1"> actualCutW = customerPiece.width;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> fitNormal = (usedStockPiece.length &gt;= customerPiece.length - </span><span class="s14">EPSILON</span><span class="s1"> &amp;&amp; usedStockPiece.width &gt;= customerPiece.width - </span><span class="s14">EPSILON</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> fitRotated = (usedStockPiece.length &gt;= customerPiece.width - </span><span class="s14">EPSILON</span><span class="s1"> &amp;&amp; usedStockPiece.width &gt;= customerPiece.length - </span><span class="s14">EPSILON</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">if</span><span class="s1"> (fitRotated &amp;&amp; !fitNormal) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>[actualCutL, actualCutW] = [customerPiece.width, customerPiece.length];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>} </span><span class="s10">else</span><span class="s1"> </span><span class="s10">if</span><span class="s1"> (fitNormal &amp;&amp; fitRotated) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> remsNormal = getGuillotineRemainders(usedStockPiece.length, usedStockPiece.width, customerPiece.length, customerPiece.width);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> totalRemAreaNormal = remsNormal.reduce((sum, r) =&gt; sum + (r.</span><span class="s14">L</span><span class="s1"> * r.</span><span class="s14">W</span><span class="s1">), </span><span class="s13">0</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> remsRotated = getGuillotineRemainders(usedStockPiece.length, usedStockPiece.width, customerPiece.width, customerPiece.length);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> totalRemAreaRotated = remsRotated.reduce((sum, r) =&gt; sum + (r.</span><span class="s14">L</span><span class="s1"> * r.</span><span class="s14">W</span><span class="s1">), </span><span class="s13">0</span><span class="s1">);</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">if</span><span class="s1"> (totalRemAreaRotated &lt; totalRemAreaNormal) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>[actualCutL, actualCutW] = [customerPiece.width, customerPiece.length];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">// Get the remainder pieces from the cut</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> remainderPieces = getGuillotineRemainders(usedStockPiece.length, usedStockPiece.width, actualCutL, actualCutW);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">// Remove the used stock piece from mutableStock</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>mutableStock.splice(bestStockIndex, </span><span class="s13">1</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">// Add back the remainder pieces if they are usable or contribute to waste</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>remainderPieces.forEach(rem =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">const</span><span class="s1"> remArea = rem.</span><span class="s14">L</span><span class="s1"> * rem.</span><span class="s14">W</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s10">if</span><span class="s1"> (rem.</span><span class="s14">L</span><span class="s1"> &gt; </span><span class="s14">EPSILON</span><span class="s1"> &amp;&amp; rem.</span><span class="s14">W</span><span class="s1"> &gt; </span><span class="s14">EPSILON</span><span class="s1"> &amp;&amp; remArea &gt; wasteThresholdArea - </span><span class="s14">EPSILON</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>mutableStock.push({</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>length: rem.</span><span class="s14">L</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>width: rem.</span><span class="s14">W</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>area: remArea</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>});</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                        </span>} </span><span class="s10">else</span><span class="s5"> </span><span class="s10">if</span><span class="s5"> (remArea &gt; </span><span class="s14">EPSILON</span><span class="s5">) { </span><span class="s1">// If remainder is positive but below threshold, it's waste</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>totalChargeableWasteArea += remArea;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s1">// Re-sort mutableStock to keep largest pieces at the top for next customer piece</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>mutableStock.sort((a, b) =&gt; b.area - a.area);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s10">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>unfulfilledCount++;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Display warning if any customer demand is unfulfilled</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> (unfulfilledCount &gt; </span><span class="s13">0</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>unfulfilledDemandMessage.classList.remove(</span><span class="s7">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>calculatedCutsDisplay.textContent = totalCuts.toString();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>calculatedWasteAreaDisplay.textContent = totalChargeableWasteArea.toFixed(</span><span class="s13">2</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// 5. Calculate Final Quote</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> totalCustomerArea = customerPieces.filter(p =&gt; p.fulfilled).reduce((sum, p) =&gt; sum + p.area, </span><span class="s13">0</span><span class="s1">);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> materialValue = (totalCustomerArea + totalChargeableWasteArea) * unitPriceOriginal * fragmentMarkupFactor;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> cuttingServiceCost = totalCuts * pricePerCut;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> finalCalculatedPrice = materialValue + cuttingServiceCost;</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Store current calculated values for LLM explanation</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>currentTotalCustomerArea = totalCustomerArea;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>currentTotalChargeableWasteArea = totalChargeableWasteArea;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>currentTotalCuts = totalCuts;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>currentPricePerCut = pricePerCut;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>currentFinalCalculatedPrice = finalCalculatedPrice;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Apply custom rounding</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>finalCalculatedPrice = roundToNearestFive(finalCalculatedPrice);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>finalPriceDisplay.textContent = </span><span class="s7">`</span><span class="s15">$</span><span class="s1">${finalCalculatedPrice.toFixed(</span><span class="s13">2</span><span class="s1">)}</span><span class="s7">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Function to call Gemini API for explanation</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> getLlmExplanation() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>llmExplanationOutput.classList.add(</span><span class="s7">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>llmLoadingSpinner.classList.add(</span><span class="s7">'active'</span><span class="s1">); </span><span class="s12">// Show spinner</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p11"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s5"> prompt = </span><span class="s1">`作為一家木材店的銷售人員，請用繁體中文，以友善且易於理解的方式，向客戶解釋以下木板零散切割的報價：</span></p>
<p class="p5"><span class="s7">- 客戶所需木板總面積：</span><span class="s1">${currentTotalCustomerArea.toFixed(</span><span class="s13">2</span><span class="s1">)}</span><span class="s7"> 平方尺</span></p>
<p class="p5"><span class="s7">- 因切割產生並計入成本的廢料面積：</span><span class="s1">${currentTotalChargeableWasteArea.toFixed(</span><span class="s13">2</span><span class="s1">)}</span><span class="s7"> 平方尺</span></p>
<p class="p5"><span class="s7">- 總切割刀數：</span><span class="s1">${currentTotalCuts}</span><span class="s7"> 刀</span></p>
<p class="p5"><span class="s7">- 每刀費用：</span><span class="s1">${currentPricePerCut.toFixed(</span><span class="s13">2</span><span class="s1">)}</span><span class="s7"> 元</span></p>
<p class="p5"><span class="s7">- 最終報價：</span><span class="s1">${currentFinalCalculatedPrice.toFixed(</span><span class="s13">2</span><span class="s1">)}</span><span class="s7"> 元</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p11"><span class="s1">請強調價格包含了材料、切割服務和廢料處理的成本，並解釋零散切割通常會比整板貴的原因。請避免使用專業術語，保持語氣親切。`</span><span class="s5">;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">let</span><span class="s1"> chatHistory = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>chatHistory.push({ role: </span><span class="s7">"user"</span><span class="s1">, parts: [{ text: prompt }] });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> payload = { contents: chatHistory };</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s5"> apiKey = </span><span class="s7">""</span><span class="s5">; </span><span class="s1">// Canvas will automatically provide this</span></p>
<p class="p11"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s5"> apiUrl = </span><span class="s1">`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=</span><span class="s5">${apiKey}</span><span class="s1">`</span><span class="s5">;</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> response = </span><span class="s10">await</span><span class="s1"> fetch(apiUrl, {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>method: </span><span class="s7">'POST'</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>headers: { </span><span class="s7">'Content-Type'</span><span class="s1">: </span><span class="s7">'application/json'</span><span class="s1"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>body: </span><span class="s14">JSON</span><span class="s1">.stringify(payload)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> result = </span><span class="s10">await</span><span class="s1"> response.json();</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> (result.candidates &amp;&amp; result.candidates.length &gt; </span><span class="s13">0</span><span class="s1"> &amp;&amp;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>result.candidates[</span><span class="s13">0</span><span class="s1">].content &amp;&amp; result.candidates[</span><span class="s13">0</span><span class="s1">].content.parts &amp;&amp;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>result.candidates[</span><span class="s13">0</span><span class="s1">].content.parts.length &gt; </span><span class="s13">0</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">const</span><span class="s1"> text = result.candidates[</span><span class="s13">0</span><span class="s1">].content.parts[</span><span class="s13">0</span><span class="s1">].text;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>llmExplanationOutput.textContent = text;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>llmExplanationOutput.classList.remove(</span><span class="s7">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s10">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>llmExplanationOutput.textContent = </span><span class="s7">'無法生成解釋。請稍後再試。'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>llmExplanationOutput.classList.remove(</span><span class="s7">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s7">'Gemini API response structure unexpected:'</span><span class="s1">, result);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">catch</span><span class="s1"> (error) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>llmExplanationOutput.textContent = </span><span class="s7">'生成解釋時發生錯誤。請檢查網絡連接或稍後再試。'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>llmExplanationOutput.classList.remove(</span><span class="s7">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>console.error(</span><span class="s7">'Error calling Gemini API:'</span><span class="s1">, error);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s10">finally</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>llmLoadingSpinner.classList.remove(</span><span class="s7">'active'</span><span class="s1">); </span><span class="s12">// Hide spinner</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Initialization: Add event listeners for existing rows and calculate initial areas</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>document.querySelectorAll(</span><span class="s7">'.customer-item-row'</span><span class="s1">).forEach(row =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>row.querySelectorAll(</span><span class="s7">'input'</span><span class="s1">).forEach(input =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>input.addEventListener(</span><span class="s7">'input'</span><span class="s1">, calculatePrice);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>updateItemAreaAndValidate(row);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>document.querySelectorAll(</span><span class="s7">'.stock-item-row'</span><span class="s1">).forEach(row =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>row.querySelectorAll(</span><span class="s7">'input'</span><span class="s1">).forEach(input =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>input.addEventListener(</span><span class="s7">'input'</span><span class="s1">, calculatePrice);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>updateItemAreaAndValidate(row, </span><span class="s10">true</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Add Event Listeners for buttons</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>addCustomerItemBtn.addEventListener(</span><span class="s7">'click'</span><span class="s1">, addCustomerItemRow);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>addStockItemBtn.addEventListener(</span><span class="s7">'click'</span><span class="s1">, addStockItemRow);</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>calculatePriceBtn.addEventListener(</span><span class="s7">'click'</span><span class="s1">, calculatePrice);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>explainQuoteBtn.addEventListener(</span><span class="s7">'click'</span><span class="s1">, getLlmExplanation); </span><span class="s12">// New LLM button event listener</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Event listener for unit selector change</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>globalUnitSelect.addEventListener(</span><span class="s7">'change'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> selectedUnit = globalUnitSelect.value;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>updateUnitLabels(selectedUnit); </span><span class="s12">// Update unit display for all labels</span></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">// Update area display and re-calculate price for all customer and stock items</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.querySelectorAll(</span><span class="s7">'.customer-item-row'</span><span class="s1">).forEach(row =&gt; updateItemAreaAndValidate(row));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>document.querySelectorAll(</span><span class="s7">'.stock-item-row'</span><span class="s1">).forEach(row =&gt; updateItemAreaAndValidate(row, </span><span class="s10">true</span><span class="s1">));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>calculatePrice();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Listen for changes in basic settings to trigger recalculation</span></p>
<p class="p11"><span class="s5"><span class="Apple-converted-space">        </span>document.querySelectorAll(</span><span class="s1">'#originalBoardPrice, #fragmentMarkupFactor, #wasteThresholdArea, #pricePerCut'</span><span class="s5">).forEach(input =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>input.addEventListener(</span><span class="s7">'input'</span><span class="s1">, calculatePrice);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p9"><span class="s11"></span><br></p>
<p class="p6"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">// Initial setup on page load</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>document.addEventListener(</span><span class="s7">'DOMContentLoaded'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>updateUnitLabels(globalUnitSelect.value); </span><span class="s12">// Ensure initial unit labels are correct</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>calculatePrice(); </span><span class="s12">// Perform initial calculation</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p9"><span class="s11"></span><br></p>
</body>
</html>
